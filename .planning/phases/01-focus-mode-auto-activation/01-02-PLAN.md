---
phase: 01-focus-mode-auto-activation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/page.tsx
  - src/components/WordDisplay.tsx
  - src/components/ReaderDisplay.tsx
autonomous: true

must_haves:
  truths:
    - "Rapid play/pause clicks are debounced (200ms) to prevent transition jank"
    - "Clicking word display area pauses playback and exits focus mode"
    - "Opening settings while playing auto-pauses first"
    - "Focus mode shows dimmed background with larger word display"
    - "Focus mode shows thin progress bar at bottom"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Debounced play/pause handler and auto-pause settings button"
      contains: "isDebouncing"
    - path: "src/components/WordDisplay.tsx"
      provides: "Click handler for pause functionality"
      contains: "onClick"
    - path: "src/components/ReaderDisplay.tsx"
      provides: "Props for onPause callback and focus mode styling"
      contains: "onPause"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/ReaderDisplay.tsx"
      via: "onPause prop"
      pattern: "onPause=\\{pause\\}"
    - from: "src/components/ReaderDisplay.tsx"
      to: "src/components/WordDisplay.tsx"
      via: "onPause prop forwarding"
      pattern: "onPause=\\{onPause\\}"
---

<objective>
Add interaction enhancements for focus mode: debounced play/pause, click-to-pause on word display, auto-pause before settings, and enhanced focus mode visual styling.

Purpose: Prevent jank from rapid state changes, allow intuitive pause-by-click, ensure settings are accessible while playing, and provide immersive reading experience per CONTEXT.md decisions.
Output: Polished focus mode interactions with proper visual hierarchy.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-focus-mode-auto-activation/01-CONTEXT.md
@.planning/phases/01-focus-mode-auto-activation/01-RESEARCH.md
@src/app/page.tsx
@src/components/WordDisplay.tsx
@src/components/ReaderDisplay.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add debounced play/pause handler</name>
  <files>src/app/page.tsx</files>
  <action>
    Add debouncing state near other state declarations (after line 21):
    ```tsx
    const [isDebouncing, setIsDebouncing] = useState(false);
    ```

    Create debounced play/pause handler (after handleFileLoad around line 75):
    ```tsx
    const handlePlayPause = useCallback(() => {
      if (isDebouncing) return;
      setIsDebouncing(true);
      setTimeout(() => setIsDebouncing(false), 200);

      if (isPlaying) {
        pause();
      } else if (text.trim()) {
        start(text);
      }
    }, [isDebouncing, isPlaying, text, pause, start]);
    ```

    Update keyboard handler (Space case around line 89-97) to use debouncing:
    ```tsx
    case 'Space':
      e.preventDefault();
      if (isDebouncing) return;
      setIsDebouncing(true);
      setTimeout(() => setIsDebouncing(false), 200);
      if (isPlaying) {
        pause();
      } else if (words.length > 0 && !isComplete) {
        start(text);
      } else if (isComplete && text.trim()) {
        start(text);
      }
      break;
    ```

    Add isDebouncing to useEffect dependency array (line 120).

    Update settings button (around line 139-163) to auto-pause before opening:
    ```tsx
    <button
      onClick={() => {
        if (isPlaying) {
          pause();
        }
        setShowSettings(true);
      }}
      ...
    ```
  </action>
  <verify>
    1. `npx tsc --noEmit` - no type errors
    2. Rapid-click play/pause - transitions are smooth, no jank
    3. Press space rapidly - debouncing prevents stutter
    4. While playing, click settings gear - auto-pauses, then modal opens
  </verify>
  <done>Play/pause debounced at 200ms, settings button auto-pauses playback</done>
</task>

<task type="auto">
  <name>Task 2: Add click-to-pause on WordDisplay and ReaderDisplay</name>
  <files>src/components/WordDisplay.tsx, src/components/ReaderDisplay.tsx</files>
  <action>
    **WordDisplay.tsx changes:**

    Update interface to accept optional onPause callback (around line 6):
    ```tsx
    interface WordDisplayProps {
      word: string;
      containerRef: React.RefObject<HTMLDivElement>;
      onPause?: () => void;
    }
    ```

    Update component signature (line 11):
    ```tsx
    export function WordDisplay({ word, containerRef, onPause }: WordDisplayProps)
    ```

    Import useCallback (line 3):
    ```tsx
    import { useRef, useEffect, useState, useCallback } from 'react';
    ```

    Add click handler before the return statement (around line 51):
    ```tsx
    const handleClick = useCallback(() => {
      if (onPause) {
        onPause();
      }
    }, [onPause]);
    ```

    Add click handler, cursor, and accessibility to the word-display div (around line 65-76):
    ```tsx
    <div
      className="word-display cursor-pointer"
      style={{...}}
      onClick={handleClick}
      role="button"
      tabIndex={0}
      onKeyDown={(e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          handleClick();
        }
      }}
    >
    ```

    Also add the same click handler, cursor, and accessibility to the "Ready to read" state (around line 52-60):
    ```tsx
    <div
      className="word-display text-white/40 text-2xl cursor-pointer"
      style={{ left: '50%', transform: 'translateX(-50%)' }}
      onClick={handleClick}
      role="button"
      tabIndex={0}
    >
    ```

    **ReaderDisplay.tsx changes:**

    Update interface to accept optional onPause (around line 6):
    ```tsx
    interface ReaderDisplayProps {
      word: string;
      current: number;
      total: number;
      progress: number;
      isComplete: boolean;
      onPause?: () => void;
    }
    ```

    Update destructuring (line 14):
    ```tsx
    export function ReaderDisplay({
      word,
      current,
      total,
      progress,
      isComplete,
      onPause,
    }: ReaderDisplayProps)
    ```

    Pass onPause to WordDisplay (line 42):
    ```tsx
    <WordDisplay word={word} containerRef={containerRef} onPause={onPause} />
    ```
  </action>
  <verify>
    1. `npx tsc --noEmit` - no type errors
    2. Click word display while playing - reading pauses
    3. Click "Ready to read" - nothing happens (no pause needed)
    4. Use keyboard (Enter/Space) on focused word display - pauses
  </verify>
  <done>WordDisplay and ReaderDisplay support click-to-pause functionality</done>
</task>

<task type="auto">
  <name>Task 3: Wire onPause prop and enhance focus mode styling</name>
  <files>src/app/page.tsx</files>
  <action>
    Pass onPause to ReaderDisplay (around line 205):
    ```tsx
    <ReaderDisplay
      word={currentWord}
      current={currentIndex}
      total={totalWords}
      progress={progress}
      isComplete={isComplete}
      onPause={pause}
    />
    ```

    Enhance focus mode styling per CONTEXT.md decisions. Update the reader display wrapper (around line 199-221):
    ```tsx
    {/* Reader Display - always visible, enhanced in focus mode */}
    <div
      className={`transition-all duration-200 motion-reduce:transition-none ${
        isFocusMode
          ? 'fixed inset-0 z-40 flex items-center justify-center bg-dark/95 p-8'
          : ''
      }`}
    >
      <div className={`transition-transform duration-200 motion-reduce:transition-none ${
        isFocusMode ? 'w-full max-w-4xl scale-110 sm:scale-125' : ''
      }`}>
        <ReaderDisplay
          word={currentWord}
          current={currentIndex}
          total={totalWords}
          progress={progress}
          isComplete={isComplete}
          onPause={pause}
        />
      </div>
    </div>
    ```

    Key styling changes per CONTEXT.md:
    - `bg-dark/95` - slight dim (95% opacity) instead of solid dark
    - `duration-200` - quick fade (~150-200ms)
    - `scale-110 sm:scale-125` - ~20% larger word display, responsive for mobile
    - All transitions respect `motion-reduce:` prefix
  </action>
  <verify>
    1. `npx tsc --noEmit` - no type errors
    2. Click word display while playing - pauses and exits focus mode
    3. Focus mode shows dimmed background (95% opacity)
    4. Word display is visibly larger in focus mode
    5. On small screen (mobile width), scaling is reduced to prevent overflow
  </verify>
  <done>Focus mode has enhanced styling with click-to-pause wired through component hierarchy</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run dev` runs successfully
3. Manual test flow:
   - Rapid-click play button multiple times → transitions smooth, no stutter
   - While playing, click word display → pauses, exits focus mode
   - While playing, click settings gear → auto-pauses, modal opens
   - Focus mode shows dimmed overlay (bg-dark/95), word display ~20% larger
   - On mobile viewport (375px), word display scales appropriately
4. Accessibility:
   - Enable reduced motion preference → instant transitions
   - Tab to word display, press Enter → pauses
</verification>

<success_criteria>
- Rapid play/pause clicks debounced at 200ms
- Clicking word display pauses playback
- Settings button auto-pauses before opening modal
- Focus mode has dimmed background (95% opacity)
- Word display scales ~20% larger in focus mode
- Mobile-responsive scaling (scale-110 on small screens)
- All transitions respect prefers-reduced-motion
</success_criteria>

<output>
After completion, create `.planning/phases/01-focus-mode-auto-activation/01-02-SUMMARY.md`
</output>
