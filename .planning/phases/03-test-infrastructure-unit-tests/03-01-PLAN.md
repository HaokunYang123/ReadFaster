---
phase: 03-test-infrastructure-unit-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vitest.config.mts
  - package.json
  - src/test-utils/setup.ts
  - src/test-utils/fixtures.ts
  - tsconfig.json
autonomous: true

must_haves:
  truths:
    - "Developer can run npm test and Vitest executes"
    - "Tests can import using @/* path aliases"
    - "jest-dom matchers are available in test files"
    - "localStorage is mockable in jsdom environment"
  artifacts:
    - path: "vitest.config.mts"
      provides: "Vitest configuration with jsdom, v8 coverage, path aliases"
      contains: "defineConfig"
    - path: "package.json"
      provides: "Test scripts"
      contains: "vitest"
    - path: "src/test-utils/setup.ts"
      provides: "Global test setup with jest-dom matchers"
      contains: "@testing-library/jest-dom"
    - path: "src/test-utils/fixtures.ts"
      provides: "Unicode test corpus for multi-language testing"
      contains: "CJK"
  key_links:
    - from: "vitest.config.mts"
      to: "src/test-utils/setup.ts"
      via: "setupFiles configuration"
      pattern: "setupFiles.*setup"
---

<objective>
Set up Vitest testing infrastructure for Next.js 14 project with TypeScript support.

Purpose: Enable unit testing with proper browser API emulation, path alias resolution, and shared test utilities for subsequent test plans.

Output: Working Vitest configuration, test scripts in package.json, test-utils folder with setup and fixtures.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-test-infrastructure-unit-tests/03-RESEARCH.md
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vitest dependencies and add test scripts</name>
  <files>package.json</files>
  <action>
Install Vitest and related dependencies:
```bash
npm install -D vitest @vitejs/plugin-react jsdom @testing-library/react @testing-library/jest-dom vite-tsconfig-paths @vitest/coverage-v8
```

Add test scripts to package.json:
- "test": "vitest" (watch mode by default)
- "test:coverage": "vitest run --coverage" (single run with coverage report)

Do NOT add "test:e2e" yet - that belongs to Phase 5.
  </action>
  <verify>
Run `npm test -- --run` to verify Vitest executes (will show "no tests found" which is expected).
Check package.json contains vitest in devDependencies.
  </verify>
  <done>Vitest installed, test scripts added to package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create Vitest configuration file</name>
  <files>vitest.config.mts</files>
  <action>
Create vitest.config.mts in project root with:
- `tsconfigPaths()` plugin for @/* path alias resolution
- `react()` plugin for React JSX support
- `environment: 'jsdom'` for browser API emulation
- `setupFiles: ['./src/test-utils/setup.ts']` for global setup
- Coverage configuration with v8 provider, text reporter only (per CONTEXT.md decision)
- Coverage exclusions: node_modules, test-utils, *.d.ts, *.config.*, *.test.ts, *.test.tsx

Reference pattern from RESEARCH.md "Complete Vitest Configuration" section.
  </action>
  <verify>
Run `npm test -- --run` to verify Vitest loads configuration without errors.
  </verify>
  <done>vitest.config.mts exists with jsdom environment and path alias support</done>
</task>

<task type="auto">
  <name>Task 3: Create test utilities (setup and fixtures)</name>
  <files>src/test-utils/setup.ts, src/test-utils/fixtures.ts</files>
  <action>
Create src/test-utils/ folder with two files:

**setup.ts:**
- Import `@testing-library/jest-dom/vitest` for custom matchers
- Import `cleanup` from `@testing-library/react`
- Add `afterEach(() => cleanup())` for automatic DOM cleanup
- This enables toBeInTheDocument(), toHaveTextContent(), etc. in all tests

**fixtures.ts:**
- Export Unicode test corpus constants for multi-language testing:
  - CJK_WORDS: array of Chinese/Japanese/Korean words (e.g., 'æ—¥æœ¬èª', 'í•œêµ­ì–´', 'ä¸­æ–‡')
  - RTL_WORDS: array of Arabic/Hebrew words (e.g., 'Ù…Ø±Ø­Ø¨Ø§', '×©×œ×•×')
  - EMOJI_WORDS: array of emoji including surrogate pairs (e.g., 'ğŸ‘‹', 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', 'ğŸ‰')
  - ACCENTED_WORDS: array of accented Latin characters (e.g., 'cafÃ©', 'naÃ¯ve', 'rÃ©sumÃ©')
  - EDGE_CASE_STRINGS: object with empty string, single char, 100+ char word, whitespace-only
- Document JavaScript .length behavior in comments (e.g., 'ğŸ‘‹'.length === 2)
  </action>
  <verify>
Verify files exist: `ls src/test-utils/`
Import fixtures in a test file to verify no syntax errors.
  </verify>
  <done>Test setup file enables jest-dom matchers, fixtures provide Unicode corpus</done>
</task>

</tasks>

<verification>
1. `npm test -- --run` executes without configuration errors
2. `ls src/test-utils/` shows setup.ts and fixtures.ts
3. vitest.config.mts exists in project root
4. package.json has "test" and "test:coverage" scripts
</verification>

<success_criteria>
- Vitest runs successfully with `npm test`
- jsdom environment provides localStorage and DOM APIs
- Path aliases (@/*) resolve correctly in test files
- jest-dom matchers available for assertions
- Unicode test fixtures ready for subsequent test plans
</success_criteria>

<output>
After completion, create `.planning/phases/03-test-infrastructure-unit-tests/03-01-SUMMARY.md`
</output>
