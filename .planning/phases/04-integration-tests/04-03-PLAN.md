---
phase: 04-integration-tests
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/__tests__/integration/components/WordDisplay.test.tsx
  - src/__tests__/integration/components/Controls.test.tsx
  - src/__tests__/integration/components/SettingsModal.test.tsx
autonomous: true

must_haves:
  truths:
    - "WordDisplay component renders pivot letter with correct highlighting"
    - "WordDisplay component calls onPause when clicked"
    - "Controls component enables/disables buttons based on playback state"
    - "Controls component fires callbacks when buttons clicked"
    - "SettingsModal component updates settings when options changed"
    - "Components render CJK, RTL, and emoji text without errors"
  artifacts:
    - path: "src/__tests__/integration/components/WordDisplay.test.tsx"
      provides: "Integration tests for WordDisplay pivot rendering and click-to-pause"
      min_lines: 80
    - path: "src/__tests__/integration/components/Controls.test.tsx"
      provides: "Integration tests for Controls button states and interactions"
      min_lines: 80
    - path: "src/__tests__/integration/components/SettingsModal.test.tsx"
      provides: "Integration tests for SettingsModal settings updates"
      min_lines: 80
  key_links:
    - from: "WordDisplay.test.tsx"
      to: "WordDisplay.tsx"
      via: "render component with props"
      pattern: "render.*WordDisplay"
    - from: "Controls.test.tsx"
      to: "Controls.tsx"
      via: "render component with props and mock callbacks"
      pattern: "render.*Controls"
---

<objective>
Create integration tests for React components (WordDisplay, Controls, SettingsModal) verifying rendering, user interactions, and multi-language text support.

Purpose: Ensures components correctly render pivot highlighting, respond to user interactions, and handle multi-language text (CJK, RTL, emoji) without errors.

Output: Three component test files covering INTG-05, INTG-06, INTG-07, and INTG-08 requirements.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-integration-tests/04-CONTEXT.md
@.planning/phases/04-integration-tests/04-RESEARCH.md
@.planning/phases/04-integration-tests/04-01-SUMMARY.md (will exist after 04-01)
@src/components/WordDisplay.tsx
@src/components/Controls.tsx
@src/components/SettingsModal.tsx
@src/test-utils/fixtures.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test WordDisplay component (INTG-05, INTG-08 partial)</name>
  <files>src/__tests__/integration/components/WordDisplay.test.tsx</files>
  <action>
Create WordDisplay integration tests:

1. Import test utilities:
   - render, screen, fireEvent from @testing-library/react
   - vi from vitest
   - WordDisplay from @/components/WordDisplay
   - CJK_WORDS, RTL_WORDS, EMOJI_WORDS from @/test-utils/fixtures

2. Setup:
   - Create mock containerRef using { current: { offsetWidth: 800 } } pattern
   - Mock useSettings to return default settings (or use Storage.prototype spy to control)

3. Test cases for INTG-05 (pivot rendering):
   - "renders word with before/pivot/after structure" - render "hello", verify .before-pivot, .pivot, .after-pivot elements
   - "renders pivot character at correct position" - render "Reading", verify pivot is "a" (index 2 for 7-char word)
   - "displays 'Ready to read' when word is empty" - render with empty word, verify placeholder text
   - "applies no-highlight class when showPivotHighlight is false" - mock settings with false, verify class present

4. Test cases for interaction:
   - "calls onPause when word display clicked" - render with onPause mock, click, verify called
   - "calls onPause when Enter pressed" - render, fireEvent.keyDown with Enter, verify onPause called
   - "calls onPause when Space pressed" - render, fireEvent.keyDown with Space, verify onPause called

5. Test cases for multi-language (INTG-08):
   - "renders CJK text without error" - render with CJK_WORDS[0] ('æ—¥æœ¬èªž'), verify pivot element exists
   - "renders RTL text without error" - render with RTL_WORDS[0] ('Ù…Ø±Ø­Ø¨Ø§'), verify pivot element exists
   - "renders emoji without error" - render with EMOJI_WORDS[0] ('ðŸ‘‹'), verify component mounts without throwing

Use behavior-focused test naming.
Multi-language tests are smoke tests - verify successful render only, not visual layout.
  </action>
  <verify>
Run tests: `npm test -- src/__tests__/integration/components/WordDisplay.test.tsx`
All tests pass.
  </verify>
  <done>
10+ tests covering WordDisplay pivot rendering, interactions, and multi-language smoke tests passing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Test Controls component (INTG-06)</name>
  <files>src/__tests__/integration/components/Controls.test.tsx</files>
  <action>
Create Controls integration tests:

1. Import test utilities:
   - render, screen, fireEvent from @testing-library/react
   - vi from vitest
   - Controls from @/components/Controls

2. Create mock callbacks:
   ```typescript
   const mockStart = vi.fn()
   const mockPause = vi.fn()
   const mockReset = vi.fn()
   const mockClear = vi.fn()
   const mockWpmChange = vi.fn()
   ```

3. Test cases for INTG-06 (button states):
   **Button text:**
   - "shows 'Start' when no words loaded" - hasWords=false, verify Start text
   - "shows 'Resume' when paused with words" - hasWords=true, isPlaying=false, isComplete=false, verify Resume text
   - "shows 'Restart' when playback complete" - isComplete=true, verify Restart text

   **Button enabled/disabled:**
   - "disables Start when already playing" - isPlaying=true, verify Start disabled
   - "disables Start when no text" - hasText=false, verify Start disabled
   - "enables Pause only when playing" - isPlaying=true, verify Pause enabled
   - "disables Pause when not playing" - isPlaying=false, verify Pause disabled
   - "disables Reset when no words and not playing" - hasWords=false, isPlaying=false, verify Reset disabled
   - "disables Clear when playing" - isPlaying=true, verify Clear disabled

   **Callbacks:**
   - "fires onStart when Start clicked" - click Start, verify mockStart called
   - "fires onPause when Pause clicked" - click Pause, verify mockPause called
   - "fires onReset when Reset clicked" - click Reset, verify mockReset called
   - "fires onClear when Clear clicked" - click Clear, verify mockClear called
   - "fires onWpmChange when slider changed" - change slider value, verify mockWpmChange called with new value

Use behavior-focused test naming.
Verify button states via toBeDisabled() matcher.
  </action>
  <verify>
Run tests: `npm test -- src/__tests__/integration/components/Controls.test.tsx`
All tests pass.
  </verify>
  <done>
14+ tests covering Controls button states and interactions passing.
  </done>
</task>

<task type="auto">
  <name>Task 3: Test SettingsModal component (INTG-07)</name>
  <files>src/__tests__/integration/components/SettingsModal.test.tsx</files>
  <action>
Create SettingsModal integration tests:

1. Import test utilities:
   - render, screen, fireEvent from @testing-library/react
   - vi from vitest
   - SettingsModal from @/components/SettingsModal
   - DEFAULT_SETTINGS from @/types

2. Create mock callbacks:
   ```typescript
   const mockClose = vi.fn()
   const mockUpdate = vi.fn()
   const mockReset = vi.fn()
   ```

3. Test cases for INTG-07:
   **Visibility:**
   - "renders nothing when isOpen is false" - isOpen=false, verify no modal content
   - "renders modal content when isOpen is true" - isOpen=true, verify Settings heading visible

   **Settings updates:**
   - "calls onUpdate with fontFamily when select changed" - change fontFamily select to 'serif', verify onUpdate called with { fontFamily: 'serif' }
   - "calls onUpdate with fontWeight when select changed" - change to 'bold', verify onUpdate called
   - "calls onUpdate with fontSize when select changed" - change to 'large', verify onUpdate called
   - "calls onUpdate with showPivotHighlight when checkbox toggled" - toggle checkbox, verify onUpdate called
   - "calls onUpdate with pivotColor when color swatch clicked" - click green swatch, verify onUpdate called with { pivotColor: '#00FF00' }
   - "disables color swatches when showPivotHighlight is false" - pass settings with showPivotHighlight=false, verify swatches disabled

   **Modal actions:**
   - "calls onReset when Reset to Defaults clicked" - click reset button, verify mockReset called
   - "calls onClose when Done clicked" - click Done, verify mockClose called
   - "calls onClose when X button clicked" - click close X, verify mockClose called

   **Preview:**
   - "shows pivot color preview with current settings" - verify preview element shows pivot with settings.pivotColor

Use behavior-focused test naming.
Test through fireEvent.change for selects and fireEvent.click for buttons.
  </action>
  <verify>
Run tests: `npm test -- src/__tests__/integration/components/SettingsModal.test.tsx`
All tests pass.
  </verify>
  <done>
12+ tests covering SettingsModal settings updates and modal interactions passing.
  </done>
</task>

</tasks>

<verification>
Run all component integration tests:
```bash
npm test -- src/__tests__/integration/components/
```

Expected: All tests pass
Expected: Multi-language smoke tests confirm successful rendering
Expected: No act() warnings
</verification>

<success_criteria>
1. WordDisplay.test.tsx has 10+ tests for pivot rendering and interactions
2. Controls.test.tsx has 14+ tests for button states and callbacks
3. SettingsModal.test.tsx has 12+ tests for settings updates
4. INTG-05 satisfied: WordDisplay renders pivot correctly
5. INTG-06 satisfied: Controls handles interactions
6. INTG-07 satisfied: SettingsModal updates settings
7. INTG-08 satisfied: Components render CJK/RTL/emoji without errors
8. All tests use behavior-focused naming convention
</success_criteria>

<output>
After completion, create `.planning/phases/04-integration-tests/04-03-SUMMARY.md`
</output>
