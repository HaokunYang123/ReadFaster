---
phase: 05-e2e-tests-cicd
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - playwright.config.ts
  - tests/e2e/pages/ReaderPage.ts
  - tests/e2e/pages/SettingsPage.ts
  - tests/e2e/pages/LibraryPage.ts
  - tests/e2e/fixtures/test-data.ts
  - package.json
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "Developer can run `npx playwright test` and Playwright executes successfully"
    - "Tests run against Chrome, Firefox, and WebKit browsers"
    - "Page Object classes encapsulate all RSVP reader interactions"
  artifacts:
    - path: "playwright.config.ts"
      provides: "Playwright configuration with multi-browser projects"
      contains: "projects:"
    - path: "tests/e2e/pages/ReaderPage.ts"
      provides: "Page Object Model for main reader interactions"
      exports: ["ReaderPage"]
    - path: "tests/e2e/pages/SettingsPage.ts"
      provides: "Page Object Model for settings modal"
      exports: ["SettingsPage"]
    - path: "tests/e2e/pages/LibraryPage.ts"
      provides: "Page Object Model for library modal"
      exports: ["LibraryPage"]
  key_links:
    - from: "playwright.config.ts"
      to: "tests/e2e/**/*.spec.ts"
      via: "testDir configuration"
      pattern: "testDir.*tests/e2e"
---

<objective>
Set up Playwright E2E testing infrastructure with Page Object Model pattern.

Purpose: Establish the foundation for E2E tests with multi-browser configuration and reusable page interaction classes.
Output: Playwright configured with Chrome/Firefox/WebKit projects, plus POM classes for all major UI sections.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-e2e-tests-cicd/05-RESEARCH.md
@src/app/page.tsx
@src/components/Controls.tsx
@src/components/SettingsModal.tsx
@src/components/Library.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and configure multi-browser testing</name>
  <files>package.json, playwright.config.ts, .gitignore</files>
  <action>
    Install Playwright as dev dependency:
    ```
    npm install -D @playwright/test
    npx playwright install --with-deps
    ```

    Create playwright.config.ts at project root with:
    - testDir: './tests/e2e'
    - fullyParallel: true
    - forbidOnly: !!process.env.CI (prevent .only in CI)
    - retries: process.env.CI ? 2 : 0 (retry in CI only)
    - workers: process.env.CI ? 1 : undefined (parallel locally)
    - reporter: process.env.CI ? 'list' : 'html' (simple CI output)
    - use.baseURL: 'http://localhost:3000'
    - use.trace: 'on-first-retry' (traces only on retry)
    - use.screenshot: 'only-on-failure'
    - Projects for chromium, firefox, webkit (use devices['Desktop Chrome'], etc.)
    - Add mobile viewport project with devices['iPhone 12'] (375px width)
    - webServer config: command 'npm run dev', url 'http://localhost:3000', reuseExistingServer: !process.env.CI

    Add to package.json scripts:
    - "test:e2e": "playwright test"
    - "test:e2e:ui": "playwright test --ui"

    Add to .gitignore:
    - /test-results/
    - /playwright-report/
    - /playwright/.cache/
  </action>
  <verify>
    Run `npm run test:e2e` - should execute Playwright (will show 0 tests found initially).
    Verify playwright.config.ts exists with 4 projects (chromium, firefox, webkit, mobile).
  </verify>
  <done>
    Playwright installed, configured for 4 browser/viewport targets, test scripts in package.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Page Object Model classes for E2E tests</name>
  <files>tests/e2e/pages/ReaderPage.ts, tests/e2e/pages/SettingsPage.ts, tests/e2e/pages/LibraryPage.ts, tests/e2e/fixtures/test-data.ts</files>
  <action>
    Create tests/e2e/pages/ directory structure.

    Create ReaderPage.ts:
    - Constructor takes Page from Playwright
    - Locators for: textInput (textarea), startButton, pauseButton, resetButton, clearButton
    - Locators for: wordDisplay (uses data-testid), focusModeOverlay, progressBar
    - Locators for: wpmInput/slider, settingsButton
    - Methods: goto(), pasteText(text), startReading(), pauseReading()
    - Methods: expectFocusModeActive(), expectFocusModeInactive()
    - Methods: getCurrentWord(), getProgress(), setWpm(value)
    - Use semantic selectors where possible (getByRole, getByLabel), fallback to data-testid

    Note: The app may not have all data-testid attributes. Use robust selectors:
    - Start button: getByRole('button', { name: /start/i })
    - Pause button: getByRole('button', { name: /pause/i })
    - Textarea: getByRole('textbox') or locator('textarea')
    - Focus mode: Check for fixed overlay with bg-dark/95 class presence

    Create SettingsPage.ts:
    - Constructor takes Page
    - Locators for: modal container, closeButton, pivotColorSelect, fontFamilySelect
    - Locators for: fontSizeSelect, fontWeightSelect, resetButton
    - Methods: open() (click settings button), close()
    - Methods: selectPivotColor(color), selectFontFamily(font)
    - Methods: expectModalVisible(), expectModalHidden()

    Create LibraryPage.ts:
    - Constructor takes Page
    - Locators for: saveButton, savedTextsList, textTitleInput
    - Methods: open(), saveCurrentText(title), loadText(title), deleteText(title)
    - Methods: expectTextInLibrary(title), expectTextNotInLibrary(title)

    Create test-data.ts with:
    - SAMPLE_TEXT: "The quick brown fox jumps over the lazy dog"
    - LONG_TEXT: A paragraph with 50+ words for complete flow testing
    - MULTI_LANGUAGE_TEXT: "Hello world" for basic tests
  </action>
  <verify>
    TypeScript compiles without errors: `npx tsc --noEmit tests/e2e/**/*.ts`
    All POM files exist and export their classes.
  </verify>
  <done>
    Page Object Model classes created for ReaderPage, SettingsPage, LibraryPage.
    Test data fixtures ready for E2E tests.
  </done>
</task>

</tasks>

<verification>
1. `npm run test:e2e` executes without errors (shows 0 tests)
2. playwright.config.ts includes chromium, firefox, webkit, mobile projects
3. POM classes exist: tests/e2e/pages/ReaderPage.ts, SettingsPage.ts, LibraryPage.ts
4. Test data file exists: tests/e2e/fixtures/test-data.ts
</verification>

<success_criteria>
- Playwright is installed and configured with multi-browser support
- All POM classes export correctly and use robust selectors
- test:e2e script runs without errors
- Infrastructure ready for E2E test files in subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/05-e2e-tests-cicd/05-01-SUMMARY.md`
</output>
