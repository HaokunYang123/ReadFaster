---
phase: 05-e2e-tests-cicd
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - tests/e2e/reading-flow.spec.ts
  - tests/e2e/keyboard.spec.ts
autonomous: true

must_haves:
  truths:
    - "User can paste text, play, pause, resume, and complete reading in browser"
    - "Keyboard shortcuts (space, arrows) control playback and speed"
    - "E2E tests pass in Chrome, Firefox, and WebKit browsers"
  artifacts:
    - path: "tests/e2e/reading-flow.spec.ts"
      provides: "Complete reading workflow E2E tests"
      contains: "test.describe"
    - path: "tests/e2e/keyboard.spec.ts"
      provides: "Keyboard shortcut E2E tests"
      contains: "page.keyboard.press"
  key_links:
    - from: "tests/e2e/reading-flow.spec.ts"
      to: "tests/e2e/pages/ReaderPage.ts"
      via: "import and instantiation"
      pattern: "new ReaderPage"
---

<objective>
Create E2E tests for core reading flow and keyboard shortcut functionality.

Purpose: Validate that the primary user journey (paste → play → pause → complete) works correctly across all browsers, and keyboard shortcuts function as expected.
Output: E2E test files covering E2E-01, E2E-02, E2E-07, E2E-08, E2E-09 requirements.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-e2e-tests-cicd/05-01-SUMMARY.md
@src/app/page.tsx
@tests/e2e/pages/ReaderPage.ts
@tests/e2e/fixtures/test-data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create complete reading flow E2E tests</name>
  <files>tests/e2e/reading-flow.spec.ts</files>
  <action>
    Create reading-flow.spec.ts with test.describe('Complete reading flow'):

    Test: "user can paste text and see it in textarea"
    - Navigate to home page
    - Fill textarea with SAMPLE_TEXT
    - Expect textarea to contain the text

    Test: "user can start reading and see first word displayed"
    - Paste SAMPLE_TEXT
    - Click start button
    - Expect word display area to contain "The" (first word)
    - Expect focus mode overlay to be visible

    Test: "user can pause reading"
    - Start reading with SAMPLE_TEXT
    - Wait briefly for word advancement (~500ms)
    - Click pause button (or press space if no visible pause button in focus mode)
    - Expect isPlaying state to be false (can check via UI state change)
    - Note: Focus mode may hide controls - use keyboard or overlay click

    Test: "user can resume reading after pause"
    - Start, pause, then click start/resume
    - Expect word display to continue advancing
    - Expect focus mode to reactivate

    Test: "user completes reading when all words processed"
    - Use SHORT_TEXT (3-4 words) for faster completion
    - Start reading at high WPM (set to 1000 via input before starting)
    - Wait for completion (~500ms for short text)
    - Expect focus mode to deactivate (overlay hidden)
    - Expect completion state visible in UI

    Test: "reading flow works in all browsers"
    - This is inherently tested by running all tests across browser projects
    - Add annotation noting E2E-07, E2E-08, E2E-09 coverage

    Use ReaderPage POM for all interactions.
    Use test.slow() for tests that need longer timeouts.
    Avoid waitForTimeout where possible - use expect.toBeVisible() or similar auto-waiting assertions.
  </action>
  <verify>
    Run `npm run test:e2e tests/e2e/reading-flow.spec.ts` - all tests pass.
    Tests execute in chromium, firefox, webkit projects without failures.
  </verify>
  <done>
    Complete reading flow tested: paste → play → pause → resume → complete.
    E2E-01, E2E-07, E2E-08, E2E-09 requirements covered.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create keyboard shortcuts E2E tests</name>
  <files>tests/e2e/keyboard.spec.ts</files>
  <action>
    Create keyboard.spec.ts with test.describe('Keyboard shortcuts'):

    Test: "space key toggles play/pause"
    - Paste text
    - Press Space to start (when not in input)
    - Expect focus mode active / reading started
    - Press Space again to pause
    - Expect reading paused

    Test: "space key does not activate when typing in textarea"
    - Focus on textarea
    - Press Space
    - Expect no reading to start (space appears in textarea instead)

    Test: "arrow up increases WPM"
    - Paste text, start reading
    - Note current WPM (300 default)
    - Press ArrowUp
    - Expect WPM to increase by 50 (to 350)
    - Press ArrowUp again
    - Expect WPM at 400

    Test: "arrow down decreases WPM"
    - Start reading at default WPM
    - Press ArrowDown
    - Expect WPM to decrease by 50 (to 250)
    - Verify minimum WPM (100) is respected - press down many times

    Test: "arrow left skips backward"
    - Start reading, wait for several words to advance
    - Pause reading
    - Note current word index
    - Press ArrowLeft
    - Expect word index to decrease (skip backward by SKIP_AMOUNT=10 or less if near start)

    Test: "arrow right skips forward"
    - Start reading with long text
    - Press ArrowRight
    - Expect word index to increase by SKIP_AMOUNT (10)

    For WPM verification:
    - The WPM value may be visible in Controls component
    - Use locator to find WPM display/input and check value

    Use page.keyboard.press('Space'), page.keyboard.press('ArrowUp'), etc.
    Ensure keyboard events are not captured by inputs (click elsewhere first if needed).
  </action>
  <verify>
    Run `npm run test:e2e tests/e2e/keyboard.spec.ts` - all tests pass.
    Keyboard shortcuts work correctly across browsers.
  </verify>
  <done>
    Keyboard shortcuts tested: space (play/pause), arrows (speed, skip).
    E2E-02 requirement fully covered.
  </done>
</task>

</tasks>

<verification>
1. `npm run test:e2e` passes for reading-flow.spec.ts and keyboard.spec.ts
2. Tests run successfully on chromium, firefox, webkit
3. Complete reading flow verified: paste → play → pause → resume → complete
4. Keyboard shortcuts verified: space, arrow keys
</verification>

<success_criteria>
- All reading flow tests pass across 3 browsers
- Keyboard shortcuts work correctly for play/pause and speed/skip control
- E2E-01, E2E-02, E2E-07, E2E-08, E2E-09 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/05-e2e-tests-cicd/05-02-SUMMARY.md`
</output>
