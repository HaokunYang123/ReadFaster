---
phase: 02-pivot-customization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/SettingsModal.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle pivot highlighting on/off via checkbox"
    - "User can select pivot color from 6 preset swatches"
    - "Selected color applies immediately (no save button)"
    - "Inline preview shows current pivot style"
    - "Reset button appears only when color is not default"
    - "Color swatches are disabled when highlighting is off"
  artifacts:
    - path: "src/components/SettingsModal.tsx"
      provides: "Pivot Highlight section with toggle, swatches, reset, preview"
      contains: "PRESET_COLORS"
  key_links:
    - from: "src/components/SettingsModal.tsx"
      to: "onUpdate callback"
      via: "onUpdate({ pivotColor }) and onUpdate({ showPivotHighlight })"
      pattern: "onUpdate.*pivot"
---

<objective>
Add Pivot Highlight settings section to SettingsModal with checkbox toggle, color swatches, conditional reset button, and inline preview.

Purpose: Provide user interface for pivot customization settings wired in Plan 01, enabling immediate visual feedback and persistence.
Output: Complete pivot customization UI in settings modal with all interactions per CONTEXT.md decisions.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-pivot-customization/02-CONTEXT.md
@.planning/phases/02-pivot-customization/02-RESEARCH.md
@src/components/SettingsModal.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add preset colors constant and import DEFAULT_SETTINGS</name>
  <files>src/components/SettingsModal.tsx</files>
  <action>
    1. Update the import to include DEFAULT_SETTINGS:

    Change:
    ```typescript
    import { RSVPSettings } from '@/types';
    ```

    To:
    ```typescript
    import { RSVPSettings, DEFAULT_SETTINGS } from '@/types';
    ```

    2. Add the preset colors constant after the imports and before the interface:

    ```typescript
    const PRESET_COLORS = [
      '#FF0000', // Red (default)
      '#FF6B00', // Orange
      '#FFD700', // Gold
      '#00FF00', // Lime Green
      '#0099FF', // Sky Blue
      '#9D00FF', // Purple
    ];
    ```

    These are 6 vibrant, saturated colors per CONTEXT.md decision. Red is first to match the default.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>PRESET_COLORS array defined with 6 vibrant colors, DEFAULT_SETTINGS imported</done>
</task>

<task type="auto">
  <name>Task 2: Add Pivot Highlight section to settings modal</name>
  <files>src/components/SettingsModal.tsx</files>
  <action>
    Add a new "Pivot Highlight" section after the Font Size section (after line 76, before the closing `</div>` of `space-y-6`).

    Insert the following JSX:

    ```tsx
    {/* Pivot Highlight */}
    <div>
      <label className="block text-sm font-medium mb-3">Pivot Highlight</label>

      {/* Toggle Checkbox */}
      <label className="flex items-center gap-2 cursor-pointer mb-4">
        <input
          type="checkbox"
          checked={settings.showPivotHighlight}
          onChange={(e) => onUpdate({ showPivotHighlight: e.target.checked })}
          className="w-4 h-4 accent-primary rounded focus:ring-primary focus:ring-2"
        />
        <span className="text-sm">Show pivot highlight</span>
      </label>

      {/* Color Swatches */}
      <div className="flex gap-2 mb-3">
        {PRESET_COLORS.map((color) => (
          <button
            key={color}
            onClick={() => onUpdate({ pivotColor: color })}
            disabled={!settings.showPivotHighlight}
            className={`relative w-10 h-10 rounded-lg border-2 transition-all ${
              !settings.showPivotHighlight
                ? 'opacity-40 cursor-not-allowed'
                : 'cursor-pointer hover:scale-110'
            } ${
              settings.pivotColor === color
                ? 'border-white'
                : 'border-white/20'
            }`}
            style={{ backgroundColor: color }}
            title={color}
          >
            {settings.pivotColor === color && settings.showPivotHighlight && (
              <svg
                className="absolute inset-0 m-auto w-5 h-5 text-white drop-shadow-lg"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fillRule="evenodd"
                  d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                  clipRule="evenodd"
                />
              </svg>
            )}
          </button>
        ))}
      </div>

      {/* Reset Button - Only shown when not default color */}
      {settings.pivotColor !== DEFAULT_SETTINGS.pivotColor && (
        <button
          onClick={() => onUpdate({ pivotColor: DEFAULT_SETTINGS.pivotColor })}
          className="text-sm text-white/60 hover:text-white underline mb-3"
        >
          Reset to default
        </button>
      )}

      {/* Inline Preview */}
      <div className="bg-black/40 border border-white/20 rounded-lg p-4 flex justify-center">
        <div
          className="text-center"
          style={{
            fontFamily: "'Courier New', monospace",
            fontSize: '32px',
            fontWeight: 500,
          }}
        >
          <span style={{ color: '#ffffff' }}>Read</span>
          <span
            style={{
              color: settings.showPivotHighlight ? settings.pivotColor : '#ffffff',
              fontWeight: settings.showPivotHighlight ? 'bold' : 500,
            }}
          >
            F
          </span>
          <span style={{ color: '#ffffff' }}>aster</span>
        </div>
      </div>
    </div>
    ```

    Key implementation details per CONTEXT.md:
    - Checkbox positioned above color swatches
    - Color swatches disabled/grayed when toggle is off
    - Checkmark only shows when color is selected AND highlighting is on
    - Reset button hidden when color is already default (resets color only, not toggle)
    - Preview word is "ReadFaster" with pivot on "F" (matches the app name)
    - Preview updates live as user changes settings
  </action>
  <verify>
    1. Run `npx tsc --noEmit` - no type errors
    2. Run `npm run dev`
    3. Open settings modal and verify:
       - "Pivot Highlight" section appears after Font Size
       - Checkbox shows "Show pivot highlight" and is checked by default
       - 6 color swatches in a row, red has white border and checkmark
       - No reset button visible (red is default)
       - Preview shows "ReadFaster" with red "F"
  </verify>
  <done>Settings modal has complete Pivot Highlight section with all controls</done>
</task>

<task type="auto">
  <name>Task 3: Verify all interactions work correctly</name>
  <files>src/components/SettingsModal.tsx</files>
  <action>
    This is a verification task - no code changes, just thorough manual testing.

    Test each interaction:

    1. **Toggle interaction:**
       - Uncheck the checkbox
       - Color swatches should become grayed out (opacity reduced)
       - Clicking swatches should have no effect
       - Preview "F" should be white (same as other letters)
       - Check the checkbox again - swatches restore, preview "F" becomes colored

    2. **Color selection:**
       - Click each swatch - border changes to white, checkmark appears
       - Preview immediately updates to show selected color
       - Close modal, reopen - selection persists

    3. **Reset button:**
       - Select a non-red color (e.g., blue)
       - "Reset to default" button appears
       - Click reset - color returns to red, button disappears
       - Reset does NOT affect the toggle (if unchecked, stays unchecked)

    4. **Persistence:**
       - Select a color (e.g., green), uncheck toggle
       - Refresh page
       - Open settings - green still selected, toggle still unchecked
       - Reader display: pivot letter white (toggle off)
       - Check toggle - pivot immediately becomes green

    If any interaction fails, fix the code. Common issues:
    - Forgot `disabled` attribute on swatch buttons when toggle is off
    - Reset button resetting both color and toggle (should only reset color)
    - Preview not updating - check it uses settings.pivotColor directly
  </action>
  <verify>
    All interactions pass as described:
    - Toggle enables/disables swatches and changes preview
    - Swatch clicks change color immediately
    - Reset only affects color, not toggle
    - Settings persist across page refresh
    - Main reader display reflects settings changes
  </verify>
  <done>All pivot customization interactions verified working correctly</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run dev` runs successfully
3. Complete interaction test:
   - Open settings modal - Pivot Highlight section visible
   - Toggle off: swatches gray, preview white "F"
   - Toggle on: swatches active, preview colored "F"
   - Click different colors: preview updates, checkmark moves
   - Click non-default color: reset button appears
   - Click reset: returns to red, button disappears
   - Close modal, start reading: pivot letter shows chosen color
   - Refresh page: settings persist
4. Accessibility: checkbox is keyboard-navigable, swatches have title attributes
</verification>

<success_criteria>
- Pivot Highlight section appears in settings modal after Font Size
- Checkbox toggles pivot highlighting on/off
- 6 color swatches displayed horizontally
- Selected swatch has white border and checkmark (when toggle on)
- Swatches disabled/grayed when toggle is off
- Reset button only visible when color differs from default
- Reset button only resets color, not toggle state
- Inline preview shows "ReadFaster" with current pivot styling
- All changes apply immediately without save button
- Settings persist across browser sessions
</success_criteria>

<output>
After completion, create `.planning/phases/02-pivot-customization/02-02-SUMMARY.md`
</output>
