---
phase: 02-pivot-customization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/index.ts
  - src/app/globals.css
  - src/components/WordDisplay.tsx
autonomous: true

must_haves:
  truths:
    - "Pivot letter color can be changed dynamically via CSS variable"
    - "When showPivotHighlight is false, pivot letter matches rest of word"
    - "Settings include pivotColor and showPivotHighlight fields"
  artifacts:
    - path: "src/types/index.ts"
      provides: "RSVPSettings with pivotColor and showPivotHighlight"
      contains: "pivotColor: string"
    - path: "src/app/globals.css"
      provides: "CSS variable-based pivot styling with no-highlight class"
      contains: "var(--pivot-color"
    - path: "src/components/WordDisplay.tsx"
      provides: "WordDisplay applying CSS variable and conditional class"
      contains: "--pivot-color"
  key_links:
    - from: "src/components/WordDisplay.tsx"
      to: "src/types/index.ts"
      via: "settings.pivotColor and settings.showPivotHighlight"
      pattern: "settings\\.(pivotColor|showPivotHighlight)"
    - from: "src/app/globals.css"
      to: "src/components/WordDisplay.tsx"
      via: "CSS variable --pivot-color set inline, consumed by .pivot"
      pattern: "--pivot-color"
---

<objective>
Extend types with pivot customization settings and wire WordDisplay to use dynamic CSS variable for pivot color.

Purpose: Enable runtime pivot color changes and toggle support at the rendering layer, preparing for UI controls in Plan 02.
Output: Settings interface extended, WordDisplay applying user-selected pivot color via CSS variable, CSS updated to support no-highlight mode.
</objective>

<execution_context>
@/Users/haokunyang/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haokunyang/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-pivot-customization/02-CONTEXT.md
@.planning/phases/02-pivot-customization/02-RESEARCH.md
@src/types/index.ts
@src/app/globals.css
@src/components/WordDisplay.tsx
@src/hooks/useSettings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend RSVPSettings with pivot customization fields</name>
  <files>src/types/index.ts</files>
  <action>
    Add two new fields to the RSVPSettings interface:

    ```typescript
    export interface RSVPSettings {
      fontFamily: 'monospace' | 'serif' | 'sans';
      fontWeight: 'normal' | 'medium' | 'bold';
      fontSize: 'small' | 'medium' | 'large';
      pivotColor: string;          // Hex color e.g. '#FF0000'
      showPivotHighlight: boolean; // Toggle for pivot highlighting
    }
    ```

    Update DEFAULT_SETTINGS to include defaults:

    ```typescript
    export const DEFAULT_SETTINGS: RSVPSettings = {
      fontFamily: 'monospace',
      fontWeight: 'medium',
      fontSize: 'medium',
      pivotColor: '#FF0000',       // Red default (matches current hardcoded)
      showPivotHighlight: true,    // On by default
    };
    ```

    This ensures new users get red pivot (existing behavior) and existing users with saved settings will merge in the new defaults via storage.ts spread pattern.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>RSVPSettings includes pivotColor and showPivotHighlight with sensible defaults</done>
</task>

<task type="auto">
  <name>Task 2: Update CSS to use variable instead of hardcoded color</name>
  <files>src/app/globals.css</files>
  <action>
    Replace the hardcoded pivot color with a CSS variable.

    Change lines 51-54 from:
    ```css
    .word-display .pivot {
      color: #FF0000;
      font-weight: bold;
    }
    ```

    To:
    ```css
    .word-display .pivot {
      color: var(--pivot-color, #FF0000);
      font-weight: bold;
    }

    /* When highlighting is disabled, pivot matches rest of word */
    .word-display.no-highlight .pivot {
      color: #ffffff;
      font-weight: 500;
    }
    ```

    The fallback `#FF0000` ensures pivot is always visible even if CSS variable is not set. The `.no-highlight` class overrides pivot styling to match `.before-pivot` and `.after-pivot` (white, normal weight).
  </action>
  <verify>
    1. Run `npm run dev`
    2. Verify pivot letter still displays red (fallback working)
    3. Browser dev tools: inspect .pivot element, confirm it shows `var(--pivot-color, #FF0000)`
  </verify>
  <done>CSS uses variable with fallback, no-highlight class defined for toggle-off state</done>
</task>

<task type="auto">
  <name>Task 3: Wire WordDisplay to apply settings via CSS variable</name>
  <files>src/components/WordDisplay.tsx</files>
  <action>
    Import useSettings hook and apply pivot customization:

    1. Add import at top:
    ```typescript
    import { useSettings } from '@/hooks/useSettings';
    ```

    2. Inside WordDisplay function, after useState line, add:
    ```typescript
    const { settings } = useSettings();
    ```

    3. Update the return JSX for the word display (around line 81) to apply CSS variable and conditional class:

    Change from:
    ```tsx
    <div
      className="word-display cursor-pointer"
      style={{
        left: offset !== null ? `${offset}px` : '50%',
        transform: offset === null ? 'translateX(-50%)' : 'none',
      }}
    ```

    To:
    ```tsx
    <div
      className={`word-display cursor-pointer ${!settings.showPivotHighlight ? 'no-highlight' : ''}`}
      style={{
        left: offset !== null ? `${offset}px` : '50%',
        transform: offset === null ? 'translateX(-50%)' : 'none',
        '--pivot-color': settings.pivotColor,
      } as React.CSSProperties}
    ```

    Note: The `as React.CSSProperties` cast is needed because TypeScript doesn't know about CSS custom properties by default.

    Also update the empty state div (around line 62) to apply the same CSS variable for consistency:
    ```tsx
    <div
      className="word-display text-white/40 text-2xl cursor-pointer"
      style={{
        left: '50%',
        transform: 'translateX(-50%)',
        '--pivot-color': settings.pivotColor,
      } as React.CSSProperties}
    ```
  </action>
  <verify>
    1. Run `npx tsc --noEmit` - no type errors
    2. Run `npm run dev`
    3. Open browser dev tools, inspect .word-display element
       - Should see `--pivot-color: #FF0000` in inline styles
       - Pivot letter should be red
    4. Manually edit localStorage to test:
       - In browser console: `localStorage.setItem('readfaster_settings', JSON.stringify({...JSON.parse(localStorage.getItem('readfaster_settings') || '{}'), pivotColor: '#00FF00'}))`
       - Refresh page - pivot should be green
       - Reset: `localStorage.removeItem('readfaster_settings')` and refresh
  </verify>
  <done>WordDisplay reads settings and applies pivotColor as CSS variable, applies no-highlight class when toggle is off</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run dev` runs successfully
3. Manual verification:
   - Paste text, click play - pivot letter is red (default)
   - In dev tools: .word-display has `--pivot-color: #FF0000` inline
   - Modifying localStorage pivotColor and refreshing changes pivot color
   - Adding `showPivotHighlight: false` to localStorage settings makes pivot white (matches text)
4. Storage merge works: existing users get new defaults without losing existing settings
</verification>

<success_criteria>
- RSVPSettings type includes pivotColor (string) and showPivotHighlight (boolean)
- DEFAULT_SETTINGS has red color and true for showPivotHighlight
- CSS .pivot uses var(--pivot-color, #FF0000)
- CSS .no-highlight .pivot renders pivot same as regular text
- WordDisplay applies CSS variable from settings
- WordDisplay adds no-highlight class when showPivotHighlight is false
- No visual change for users until they modify settings (red remains default)
</success_criteria>

<output>
After completion, create `.planning/phases/02-pivot-customization/02-01-SUMMARY.md`
</output>
